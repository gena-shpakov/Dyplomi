<script>
  const dataDrivenParts = ["lecturer", "student"];

  function choosePart(part) {
    localStorage.setItem("selectedPart", part);
    renderPart(part);
  }

  function renderPart(part) {
    const selection = document.getElementById("selection");
    const view = document.getElementById("view");

    selection.style.display = "none";
    view.innerHTML = "<p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>";

    if (dataDrivenParts.indexOf(part) !== -1) {
      const days = [
        "–ù–µ–¥—ñ–ª—è",
        "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫",
        "–í—ñ–≤—Ç–æ—Ä–æ–∫",
        "–°–µ—Ä–µ–¥–∞",
        "–ß–µ—Ç–≤–µ—Ä",
        "–ü‚Äô—è—Ç–Ω–∏—Ü—è",
        "–°—É–±–æ—Ç–∞",
      ];
      const today = new Date();
      const todayIndex = today.getDay();
      const dayName =
        todayIndex >= 1 && todayIndex <= 5 ? days[todayIndex] : "–ü–æ–Ω–µ–¥—ñ–ª–æ–∫";

      google.script.run
        .withSuccessHandler(function (data) {
          if (!data || data.length === 0) {
            view.innerHTML = `
            <div style="margin-bottom: 20px;">
              <button class="back-btn" onclick="resetPart()">–ù–∞–∑–∞–¥</button>
            </div>
            <p>–†–æ–∑–∫–ª–∞–¥—É –Ω–∞ ${dayName} –Ω–µ–º–∞—î.</p>`;
            return;
          }

          let html = `
          <div style="margin-bottom: 20px;">
            <button class="back-btn" onclick="resetPart()">–ù–∞–∑–∞–¥</button>
          </div>
          <h2 style="margin-bottom: 10px;">–†–æ–∑–∫–ª–∞–¥ –Ω–∞ ${dayName}</h2>
          <div class="schedule-table-container">
            <table class="schedule-table">
              <thead>
                <tr>
                  <th>‚Ññ –ü–∞—Ä–∏</th>
                  <th>–ù–∞–∑–≤–∞ –ø–∞—Ä–∏ —Ç–∞ –∞—É–¥–∏—Ç–æ—Ä—ñ—è</th>
                  <th>–í–∏–∫–ª–∞–¥–∞—á</th>
                </tr>
              </thead>
              <tbody>`;

          data.forEach(function (row) {
            html += `
            <tr>
                <td>${row[1]}</td>
                <td>
                  <div class="schedule-pair-title">${row[2]}</div>
                  <div class="schedule-room">${row[4]}</div>
                </td>
                <td>${row[3]}</td>
            </tr>`;
          });

          html += `</tbody></table></div>`;
          view.innerHTML = html;
        })
        .getScheduleForDay(dayName);
    } else {
      google.script.run
        .withSuccessHandler(function (html) {
          view.innerHTML = `
          <div style="margin-bottom: 20px;">
            <button class="back-btn" onclick="resetPart()">üîÑ –ó–º—ñ–Ω–∏—Ç–∏ –≤–∏–±—ñ—Ä</button>
          </div>
          ${html}`;
        })
        .loadPage(part);
    }
  }

  function resetPart() {
    localStorage.removeItem("selectedPart");
    document.getElementById("selection").style.display = "flex";
    document.getElementById("view").innerHTML = "";
    history.pushState({}, "", location.pathname);
  }

  window.onload = function () {
    const saved = localStorage.getItem("selectedPart");
    if (saved) {
      renderPart(saved);
    }
  };
</script>
