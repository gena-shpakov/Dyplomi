<script>
  const dataDrivenParts = ["lecturer", "student", "lecturer_login", "student_login"];

  function choosePart(part) {
    const title = document.querySelector("h1");
    if (title) {
      title.style.display = "none";
    }

    localStorage.setItem("selectedPart", part);
    renderPart(part);
  }

  function renderPart(part) {
    const selection = document.getElementById("selection");
    const view = document.getElementById("view");
    const title = document.querySelector("h1");

    if (title) {
      title.style.display = "none";
    }

    selection.style.display = "none";
    view.innerHTML = '<p class="loading-text">Завантаження...</p>';

    if (dataDrivenParts.indexOf(part) !== -1) {
      const days = [
        "Неділя",
        "Понеділок",
        "Вівторок",
        "Середа",
        "Четвер",
        "П’ятниця",
        "Субота",
      ];
      const today = new Date();
      const todayIndex = today.getDay();
      const dayName =
        todayIndex >= 1 && todayIndex <= 5 ? days[todayIndex] : "Понеділок";

      google.script.run
        .withSuccessHandler(function (data) {
          if (!data || data.length === 0) {
            view.innerHTML = `
            <div style="margin-bottom: 20px;">
              <button class="back-btn" onclick="resetPart()">Назад</button>
            </div>
            <p>Розкладу на ${dayName} немає.</p>`;
            return;
          }

          let html = `
          <div style="margin-bottom: 20px;">
            <button class="back-btn" onclick="resetPart()">Назад</button>
          </div>
          <div class="schedule-content">
            <h1 id="currentDay" style="text-align: center;">Розклад на ${dayName}</h1>
            <h2 id="numeratorDenominator" style="text-align: center;">Чисельник / Знаменник</h2>
            <table class="schedule-table">
              <thead>
                <tr>
                  <th>Пара</th>
                  <th>Предмет, викладач, аудиторія</th>
                  <th>Час</th>
                </tr>
              </thead>
              <tbody id="scheduleBody">`;

            data.forEach(function (row) {
              const lessonNumber = row [1];
              const subjects = row [2];
              const teacher = row [3];
              const room =  row [4];
              const time = row [5];

              html += `
                <tr>
                  <td class="group-cell">${lessonNumber}</td>
                  <td class="subject-cell">
                    <strong>${subjects}</strong><br>
                    <span class="teacher-room">${teacher}, ауд.${room}</span>
                  </td>
                <td class="time-cell">${time}</td>
              </tr>`;
            });

            html += `
                </tbody>
              </table>
            </div>`;
          view.innerHTML = html;

          view.innerHTML = html;
        })
        .getScheduleForDay(dayName);
    } else {
      google.script.run
        .withSuccessHandler(function (html) {
          view.innerHTML = `
          <div style="margin-bottom: 20px;">
            <button class="back-btn" onclick="resetPart()">Назад</button>
          </div>
          ${html}`;
        })
        .loadPage(part);
    }
  }

  function resetPart() {
    localStorage.removeItem("selectedPart");
    document.getElementById("selection").style.display = "flex";
    document.getElementById("view").innerHTML = "";
  
    const title = document.querySelector("h1");
    if (title) {
      title.style.display = "block";
    }
    
    history.pushState({}, "", location.pathname);
  }

  window.onload = function () {
    const saved = localStorage.getItem("selectedPart");
    if (saved) {
      renderPart(saved);
    }
  };
  function goBack() {
  // Показати заголовок
  const title = document.querySelector("h1");
  if (title) {
    title.style.display = "block";
  }

  // Виклик повернення на головну
  resetPart();
}
</script>
